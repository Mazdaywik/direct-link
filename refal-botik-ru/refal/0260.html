<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=koi8-r">
<TITLE>refal@botik.ru -- Discussing the Refal programming language, Re</TITLE>
<META NAME="Author" CONTENT="dmsidorov@mtu-net.ru (dmsidorov@mtu-net.ru)">
<META NAME="Subject" CONTENT="Refal6 для Linux скомпилирован">
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000">
<H1 ALIGN=CENTER>Refal6 для Linux скомпилирован</H1>
<HR>
<P>
<!-- received="Mon Nov  5 14:52:44 2001" -->
<!-- isoreceived="20011105115244" -->
<!-- sent="Mon, 5 Nov 2001 12:00:59 +0300" -->
<!-- isosent="20011105090059" -->
<!-- name="dmsidorov@mtu-net.ru" -->
<!-- email="dmsidorov@mtu-net.ru" -->
<!-- subject="Refal6 для Linux скомпилирован" -->
<!-- id="20011105120059.A283@BelCanto" -->
<!-- charset="koi8-r" -->
<!-- inreplyto="000801c16457$d6bd0a10$110d040a@Bagirra" -->
<STRONG>Subject: </STRONG>Refal6 для Linux скомпилирован<BR>
<EM>dmsidorov@mtu-net.ru</EM><BR>
<STRONG>Date: </STRONG>Mon Nov 05 2001 - 12:00:59 MSK
<P>
<UL>
<LI><STRONG>sorted by:</STRONG> 
<A HREF="date.html#260">[ date ]</A>
<A HREF="index.html#260">[ thread ]</A>
<A HREF="subject.html#260">[ subject ]</A>
<A HREF="author.html#260">[ author ]</A>
<!-- next="start" -->
<LI><STRONG>Next message:</STRONG> <A HREF="0261.html">Mike Potanin: "Re: Ядро Рефал"</A>
<LI><STRONG>Previous message:</STRONG> <A HREF="0259.html">Anton Yu. Orlov: "Re: Ядро Рефал"</A>
<!-- nextthread="start" -->
<LI><STRONG>Next in thread:</STRONG> <A HREF="0263.html">Arkady Klimov: "Re: Refal6 для Linux скомпилирован"</A>
<!-- reply="end" -->
</UL>
<HR>
<!-- body="start" -->
<P>
Здравствуйте, Аркадий.
<BR>
<P>On Sat, Nov 03, 2001 at 02:04:35PM +0300, Arkady Klimov wrote:
<BR>
<EM>&gt; | Мне очень не нравится в этом (и других) макросах использование типа
</EM><BR>
<EM>&gt; | long, длинна которого зависит от реализации.
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; Разве? В то время (начало 90х) я тоже этим интересовался и выяснил для себя
</EM><BR>
<EM>&gt; (может, я ошибался?), что размеры short и long всегда, соответственно, 16 и 32,
</EM><BR>
<EM>&gt; а вот размер int зависит от реализации - либо 16, либо 32. С другой стороны, я
</EM><BR>
<EM>&gt; не стремился в реализации рефала фиксировать все размеры: если происходит
</EM><BR>
<EM>&gt; перенос на систему, где разрядность адреса больше, то соответственно
</EM><BR>
<EM>&gt; должны увеличиваться разрядности полей под некоторые значения (например,
</EM><BR>
<EM>&gt; под индексы массивов). Таким образом, кое-где в системе использован тип int,
</EM><BR>
<EM>&gt; который в разных реализациях имеет свою разрядность: 16 или 32, и так оно
</EM><BR>
<EM>&gt; в общем-то и задумано. Но, возможно, Вы правы, и надо было всегда использовать
</EM><BR>
<EM>&gt; макросы (или определяемые типы).
</EM><BR>
<P>Сейчас пытаюсь вспомнить, где читал рекомендации по переносимости, и 
<BR>
в том числе по рекомендуемым и нерекомендуемым типам, и не могу найти, 
<BR>
возможно, даже чего-то спутал. Когда найду, напишу конкретнее. С 
<BR>
определяемыми типами, мне кажется, можно будет чувствовать себя 
<BR>
увереннее, чем с макросами. Но я не считаю, что ошибка из-за 
<BR>
несовпадения типов, вот когда кто-нибудь попробует перенести на другую 
<BR>
аппаратуру, тогда да. 
<BR>
<P><EM>&gt; | Еще один вопрос, насчет функций с пустым списком параметров. Они
</EM><BR>
<EM>&gt; | точно считаются фукциями без параметров? gcc по-умолчанию считает
</EM><BR>
<EM>&gt; | именно так, но в ANSI C их вроде полагается считать имеющими
</EM><BR>
<EM>&gt; | произвольное число параметров?
</EM><BR>
<EM>&gt; Никогда об этом ничего не слышал. Насколько я помню, произвольное число
</EM><BR>
<EM>&gt; параметров указывается всегда особо, вроде как многоточием в конце списка
</EM><BR>
<EM>&gt; параметров, но я никогда этим не пользовался.
</EM><BR>
<P>Да, произвольеое число параметров указывается именно так, но в стандарте C 
<BR>
осталось умолчание Кернигана и Ритчи насчет пустых скобок. Это хорошо, что 
<BR>
в Рефале они считаются не имеющими аргументов.
<BR>
<P><EM>&gt; Возвращаюсь к макросу. Мне кажется странным, что становится нормально, только
</EM><BR>
<EM>&gt; когда убирается операция &amp;. Вроде это нормальная логическая операция для двух long
</EM><BR>
<EM>&gt; операндов? (Замечу, что здесь использовано long, а не float, именно ради этой операции.)
</EM><BR>
<EM>&gt; А будет ли компилироваться, если предварительно эту константу вычислить в
</EM><BR>
<EM>&gt; переменную типа long?
</EM><BR>
<P>Нашел еще несколько вариантов, как убрать сообщение об ошибке, в том 
<BR>
числе просто убрав остальные два условных оператора (именно два), это 
<BR>
несомненно ошибка компилятора. Может, кто-нибудь знающий английский 
<BR>
лучше меня, поможет составить сообщение об ошибке? 
<BR>
<P>Правильно ли я понимаю, что этот макрос подставляет четырехбайтовую 
<BR>
переменную с тремя младшими байтами равными 0x6, в ячейку памяти, 
<BR>
определяемую как float, и обнуляет младшие три бита? Но что же там 
<BR>
находится, в этих битах у типа float? За них можно быть спокойным
<BR>
на другой ОС с другим компилятором?
<BR>
<P>Во всяком случае, если переделать макрос в подставляемую функцию, 
<BR>
<P>inline void cvalue2float_fun (cvalue cc, float f)
<BR>
{  cvalue2float(cc,f);
<BR>
&nbsp;&nbsp;&nbsp;};
<BR>
<P>протесты компилятора прекращаются. Так, наверно, и надежнее, поскольку 
<BR>
у макросов контроля нет. 
<BR>
<P>ri скомпилирован, правда, компоновщик выдал предупреждение:
<BR>
<P>rbeval.o: In function `rf_eval':
<BR>
/home/dima/archive/refal/c1/rbeval.c:218: the `gets' function is dangerous and should not be used.
<BR>
<P>При первом запуске ri было выдано предупреждение 
<BR>
<P>EVAL: *** Unexpected FAIL
<BR>
<P>дальше нормальное приглашение коммандной строки.
<BR>
<P>Теперь, когда Рефал скомпилирован, прошу советов, с чего лучше начать его 
<BR>
изучение, и как тестировать. Полный список исправлений для компиляции под 
<BR>
Linux пришлю позднее, когда все проверю. 
<BR>
<P>Дмитрий
<BR>
<P><!-- body="end" -->
<HR>
<P>
<UL>
<!-- next="start" -->
<LI><STRONG>Next message:</STRONG> <A HREF="0261.html">Mike Potanin: "Re: Ядро Рефал"</A>
<LI><STRONG>Previous message:</STRONG> <A HREF="0259.html">Anton Yu. Orlov: "Re: Ядро Рефал"</A>
<!-- nextthread="start" -->
<LI><STRONG>Next in thread:</STRONG> <A HREF="0263.html">Arkady Klimov: "Re: Refal6 для Linux скомпилирован"</A>
<!-- reply="end" -->
</UL>
<!-- trailer="footer" -->
<HR>
<P>
<SMALL>
<EM>
This archive was generated by <A HREF="http://www.fts.frontec.se/~dast/hypermail/">hypermail 2b25</A> 
: <EM>Mon Oct 25 2004 - 21:24:59 MSD</EM>
</EM>
</SMALL>
</BODY>
</HTML>
