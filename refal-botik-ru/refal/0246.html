<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=koi8-r">
<TITLE>refal@botik.ru -- Discussing the Refal programming language, Re</TITLE>
<META NAME="Author" CONTENT="dmsidorov@mtu-net.ru (dmsidorov@mtu-net.ru)">
<META NAME="Subject" CONTENT="Re: Компиляция Refal6 для Linu">
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000">
<H1 ALIGN=CENTER>Re: Компиляция Refal6 для Linu</H1>
<HR>
<P>
<!-- received="Sun Oct 28 19:25:29 2001" -->
<!-- isoreceived="20011028162529" -->
<!-- sent="Sun, 28 Oct 2001 00:26:37 +0400" -->
<!-- isosent="20011027202637" -->
<!-- name="dmsidorov@mtu-net.ru" -->
<!-- email="dmsidorov@mtu-net.ru" -->
<!-- subject="Re: Компиляция Refal6 для Linu" -->
<!-- id="20011028002637.B1615@BelCanto" -->
<!-- charset="koi8-r" -->
<!-- inreplyto="007901c15e3b$5a959b40$110d040a@Bagirra" -->
<STRONG>Subject: </STRONG>Re: Компиляция Refal6 для Linu<BR>
<EM>dmsidorov@mtu-net.ru</EM><BR>
<STRONG>Date: </STRONG>Sun Oct 28 2001 - 00:26:37 MSD
<P>
<UL>
<LI><STRONG>sorted by:</STRONG> 
<A HREF="date.html#246">[ date ]</A>
<A HREF="index.html#246">[ thread ]</A>
<A HREF="subject.html#246">[ subject ]</A>
<A HREF="author.html#246">[ author ]</A>
<!-- next="start" -->
<LI><STRONG>Next message:</STRONG> <A HREF="0247.html">Arkady Klimov: "Re: Компиляция Refal6 для Linu"</A>
<LI><STRONG>Previous message:</STRONG> <A HREF="0245.html">dmsidorov@mtu-net.ru: "Re: Компиляция Refal6 для Linu"</A>
<LI><STRONG>In reply to:</STRONG> <A HREF="0244.html">Arkady Klimov: "Re: Компиляция Refal6 для Linu"</A>
<!-- nextthread="start" -->
<LI><STRONG>Next in thread:</STRONG> <A HREF="0247.html">Arkady Klimov: "Re: Компиляция Refal6 для Linu"</A>
<LI><STRONG>Reply:</STRONG> <A HREF="0244.html">dmsidorov@mtu-net.ru: "Re: Компиляция Refal6 для Linu"</A>
<!-- reply="end" -->
</UL>
<HR>
<!-- body="start" -->
<P>
On Fri, Oct 26, 2001 at 08:28:50PM +0400, Arkady Klimov wrote:
<BR>
<EM>&gt; Здравствуйте, Дмитрий,
</EM><BR>
<EM>&gt; с указанной Вами ошибкой я в некоторой растерянности. (На С
</EM><BR>
<EM>&gt; я уже более 5 лет не работаю). Почему-то до сих пор ни один
</EM><BR>
<EM>&gt; компилятор в этом месте не брыкался. Что сие означает? Верно
</EM><BR>
<EM>&gt; ли, что по стандарту языка правая часть инициализатора обязана
</EM><BR>
<EM>&gt; быть константой? И почему stderr - не константа? 
</EM><BR>
<P>Здравствуйте, Аркадий.
<BR>
<P>Мои познания в C++ весьма невелики, как инженер всегда старался 
<BR>
использовать Паскаль или что-нибудь скриптовое, но вот что написано 
<BR>
в FAQ к gcc2.95:
<BR>
<P>Why can't I initialize a static variable with stdin?
<BR>
&nbsp;&nbsp;&nbsp;This has nothing to do with gcc, but people ask us about it a lot. 
<BR>
&nbsp;&nbsp;&nbsp;Code like this:
<BR>
<P>&nbsp;&nbsp;&nbsp;#include &lt;stdio.h&gt;
<BR>
&nbsp;&nbsp;&nbsp;FILE *yyin = stdin;
<BR>
<P>&nbsp;&nbsp;&nbsp;will not compile with GNU libc (Linux libc6), because stdin is not a 
<BR>
&nbsp;&nbsp;&nbsp;constant. This was done deliberately, in order for there to be no 
<BR>
&nbsp;&nbsp;&nbsp;limit on the number of open FILE objects. It is surprising for people 
<BR>
&nbsp;&nbsp;&nbsp;used to traditional Unix C libraries, but it is permitted by the C 
<BR>
&nbsp;&nbsp;&nbsp;standard.
<BR>
<P>Так что, получается, под Linux это будет считаться ошибкой как минимум 
<BR>
до выхода новой glibc, а может, и дальше.
<BR>
Кроме того, glibc теперь включает в себя определения myulong и myushort 
<BR>
(заголовок &lt;sys/types.h&gt;, включаемый через &lt;stdlib.h&gt;), полностью 
<BR>
идентичные тем, что в исходниках Рефала, поэтому ошибки не возникает, 
<BR>
но выдаются предупреждения об их переопределении. Чтобы избежать 
<BR>
двойного определения, возможно, следует использовать препроцессорную 
<BR>
директиву вроде
<BR>
<P>#if __GLIBC__ &gt;= 2
<BR>
<P>но я пока не смотрел, начиная с какой версии это появилось.
<BR>
<P><EM>&gt; В принципе, можно, наверно, поступить и так:
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; 1.удалить эту строку 43 rfstor.h
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; 2.заменить строку 40 rfstor.h на строку:
</EM><BR>
<EM>&gt; EXT FILE *    stdtrc;           /* File for debug information       */
</EM><BR>
<EM>&gt; (было:
</EM><BR>
<EM>&gt; extern FILE *    stdtrc;           /* File for debug information       */
</EM><BR>
<EM>&gt; )
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; 3. Вставить инициализацию
</EM><BR>
<EM>&gt;     stdtrc = stderr;
</EM><BR>
<EM>&gt; первым оператором в функцию initstor (файл rfstor.c, строка 256)
</EM><BR>
<EM>&gt; (эта функция вызывается первой в функции main).
</EM><BR>
<P>Этот способ сработал, после исправлений rfstor.c скомпилировался 
<BR>
нормально. Теперь остались нескомпилированы rfarm.c и rbarm.c. 
<BR>
В rbarm.c строка 252 содержит определение matherr, конфликтующее с 
<BR>
аналогичным в &lt;math.h&gt;:
<BR>
<P># ifdef __cplusplus
<BR>
extern int matherr __P ((struct __exception *__exc));
<BR>
# else
<BR>
extern int matherr __P ((struct exception *__exc));
<BR>
# endif
<BR>
<P>Сообщение об ошибке в rfarm.c совершенно непонятно:
<BR>
<P>rfarm.c: In function `rf_cgetnumb':
<BR>
rfarm.c:289: Unable to generate reloads for:
<BR>
(insn 45 43 47 (parallel[
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(set (reg:SI 0 %eax)
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(fix:SI (fix:SF (reg/v:SF 0 %eax))))
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(clobber (mem:HI (plus:SI (reg:SI 6 %ebp)
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(const_int -2 [0xfffffffe])) 0))
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(clobber (mem:HI (plus:SI (reg:SI 6 %ebp)
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(const_int -4 [0xfffffffc])) 0))
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(clobber (mem:SI (plus:SI (reg:SI 6 %ebp)
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(const_int -8 [0xfffffff8])) 0))
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(clobber (scratch:HI))
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;] ) 145 {fix_truncsfsi2+1} (insn_list 92 (nil))
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;(expr_list:REG_EQUIV (mem:SI (reg/v:SI 3 %ebx) 0)
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(expr_list:REG_DEAD (reg/v:SF 0 %eax)
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(expr_list:REG_UNUSED (scratch:HI)
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(nil)))))
<BR>
make: *** [rfarm.o] Error 1
<BR>
<P>Что делать с определением matherr в rbarm.c, я еще мог бы попробовать 
<BR>
докопаться, но насчет rfarm.c никаких идей нет. Я еще не подписан, поэтому, 
<BR>
если есть что подсказать, пишите не только в рассылку, но и на мой адрес.
<BR>
<P>С уважением, Дмитрий.
<BR>
<P><P><EM>&gt; | ----- Original Message -----
</EM><BR>
<EM>&gt; | From: dmsidorov@mtu-net.ru
</EM><BR>
<EM>&gt; | To: klimov@keldysh.ru
</EM><BR>
<EM>&gt; | сожалению, компиляция завершилась неудачей со следующим сообщением
</EM><BR>
<EM>&gt; | об ошибке:
</EM><BR>
<EM>&gt; |
</EM><BR>
<EM>&gt; | gcc rfstor.c -O -c -ggdb
</EM><BR>
<EM>&gt; | In file included from refcom.h:55,
</EM><BR>
<EM>&gt; |                  from refgen.h:16,
</EM><BR>
<EM>&gt; |                  from refint.h:14,
</EM><BR>
<EM>&gt; |                  from rfstor.c:6:
</EM><BR>
<EM>&gt; | rfstor.h:43: initializer element is not constant
</EM><BR>
<P><!-- body="end" -->
<HR>
<P>
<UL>
<!-- next="start" -->
<LI><STRONG>Next message:</STRONG> <A HREF="0247.html">Arkady Klimov: "Re: Компиляция Refal6 для Linu"</A>
<LI><STRONG>Previous message:</STRONG> <A HREF="0245.html">dmsidorov@mtu-net.ru: "Re: Компиляция Refal6 для Linu"</A>
<LI><STRONG>In reply to:</STRONG> <A HREF="0244.html">Arkady Klimov: "Re: Компиляция Refal6 для Linu"</A>
<!-- nextthread="start" -->
<LI><STRONG>Next in thread:</STRONG> <A HREF="0247.html">Arkady Klimov: "Re: Компиляция Refal6 для Linu"</A>
<LI><STRONG>Reply:</STRONG> <A HREF="0244.html">dmsidorov@mtu-net.ru: "Re: Компиляция Refal6 для Linu"</A>
<!-- reply="end" -->
</UL>
<!-- trailer="footer" -->
<HR>
<P>
<SMALL>
<EM>
This archive was generated by <A HREF="http://www.fts.frontec.se/~dast/hypermail/">hypermail 2b25</A> 
: <EM>Mon Oct 25 2004 - 21:24:59 MSD</EM>
</EM>
</SMALL>
</BODY>
</HTML>
