<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=koi8-r">
<TITLE>refal@botik.ru -- Discussing the Refal programming language, Re</TITLE>
<META NAME="Author" CONTENT="Arkady Klimov (klark@bagirra.net)">
<META NAME="Subject" CONTENT="Re: Re: Re: Re: Re: Как следует компилиоват ь ре фаль скую  операциюотождествлени">
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000">
<H1 ALIGN=CENTER>Re: Re: Re: Re: Re: Как следует компилиоват ь ре фаль скую  операциюотождествлени</H1>
<HR>
<P>
<!-- received="Fri Dec  8 18:26:40 2000" -->
<!-- isoreceived="20001208152640" -->
<!-- sent="Fri, 8 Dec 2000 15:34:50 +0300" -->
<!-- isosent="20001208123450" -->
<!-- name="Arkady Klimov" -->
<!-- email="klark@bagirra.net" -->
<!-- subject="Re: Re: Re: Re: Re: Как следует компилиоват ь ре фаль скую  операциюотождествлени" -->
<!-- id="001701c06113$a7364b00$929943c2@swan" -->
<!-- charset="koi8-r" -->
<!-- inreplyto="3A2F83DB.2090804@msu.ru" -->
<STRONG>Subject: </STRONG>Re: Re: Re: Re: Re: Как следует компилиоват ь ре фаль скую  операциюотождествлени<BR>
<STRONG>From: </STRONG>Arkady Klimov (<EM>klark@bagirra.net</EM>)<BR>
<STRONG>Date: </STRONG>Fri Dec 08 2000 - 15:34:50 MSK
<P>
<UL>
<LI><STRONG>sorted by:</STRONG> 
<A HREF="date.html#160">[ date ]</A>
<A HREF="index.html#160">[ thread ]</A>
<A HREF="subject.html#160">[ subject ]</A>
<A HREF="author.html#160">[ author ]</A>
<!-- next="start" -->
<LI><STRONG>Next message:</STRONG> <A HREF="0161.html">Sergei M. Abramov (at home): "Re: Как следует компилировать рефальскую операцию отождествления"</A>
<LI><STRONG>Previous message:</STRONG> <A HREF="0159.html">Andrey Slepuhin: "Re: Re: Re: Re: Re:  Как следует компилироват ь ре фаль скую  операциюотождествления"</A>
<LI><STRONG>In reply to:</STRONG> <A HREF="0159.html">Andrey Slepuhin: "Re: Re: Re: Re: Re:  Как следует компилироват ь ре фаль скую  операциюотождествления"</A>
<!-- nextthread="start" -->
<LI><STRONG>Next in thread:</STRONG> <A HREF="0161.html">Sergei M. Abramov (at home): "Re: Как следует компилировать рефальскую операцию отождествления"</A>
<LI><STRONG>Reply:</STRONG> <A HREF="0159.html">Arkady Klimov: "Re: Re: Re: Re: Re: Как следует компилиоват ь ре фаль скую  операциюотождествлени"</A>
<!-- reply="end" -->
</UL>
<HR>
<!-- body="start" -->
<P>
----- Original Message -----
<BR>
From: Andrey Slepuhin &lt;pooh@msu.ru&gt;
<BR>
To: Arkady Klimov &lt;klark@bagirra.net&gt;
<BR>
Cc: Sergei M. Abramov &lt;abram@botik.ru&gt;; &lt;refal@botik.ru&gt;; Anton Yu. Orlov &lt;orlov@mccme.ru&gt;
<BR>
Sent: Thursday, December 07, 2000 3:34 PM
<BR>
Subject: Re: Re: Re: Re: Re: Как следует компилироват ь ре фаль скую операциюотождествления
<BR>
<P><P>| Arkady Klimov wrote:
<BR>
|
<BR>
| &gt; ----- Original Message -----
<BR>
| &gt; From: Andrey Slepuhin &lt;pooh@msu.ru&gt;
<BR>
| &gt; To: Arkady Klimov &lt;klark@bagirra.net&gt;
<BR>
| &gt; Cc: Sergei M. Abramov &lt;abram@botik.ru&gt;; &lt;refal@botik.ru&gt;; Anton Yu. Orlov &lt;orlov@mccme.ru&gt;
<BR>
| &gt; Sent: Wednesday, December 06, 2000 11:05 PM
<BR>
| &gt; Subject: Re: Re: Re: Re: Как следует компилировать ре фаль скую операциюотождествления
<BR>
| &gt;
<BR>
| &gt;
<BR>
| &gt; | Arkady Klimov wrote:
<BR>
| &gt; |
<BR>
| &gt; | &gt; ----- Original Message -----
<BR>
| &gt; | &gt; From: Andrey Slepuhin &lt;pooh@msu.ru&gt;
<BR>
| &gt; | &gt; To: Arkady Klimov &lt;klark@bagirra.net&gt;
<BR>
| &gt; | &gt; Cc: Sergei M. Abramov &lt;abram@botik.ru&gt;; &lt;refal@botik.ru&gt;; Anton Yu. Orlov &lt;orlov@mccme.ru&gt;
<BR>
| &gt; | &gt; Sent: Wednesday, December 06, 2000 1:25 PM
<BR>
| &gt; | &gt; Subject: Re: Re: Re: Как следует компилировать рефаль скую операциюотождествления
<BR>
| &gt; | &gt;
<BR>
| &gt; | &gt;
<BR>
| &gt; | &gt; | Arkady Klimov wrote:
<BR>
| &gt; | &gt; |
<BR>
| &gt; | &gt; | &gt; ----- Original Message -----
<BR>
| &gt; | &gt; | &gt; From: Andrey Slepuhin &lt;pooh@msu.ru&gt;
<BR>
| &gt; | &gt; | &gt; To: Arkady Klimov &lt;klark@bagirra.net&gt;
<BR>
| &gt; | &gt; | &gt; Cc: Sergei M. Abramov &lt;abram@botik.ru&gt;; &lt;refal@botik.ru&gt;; Anton Yu. Orlov &lt;orlov@mccme.ru&gt;
<BR>
| &gt; | &gt; | &gt; Sent: Wednesday, December 06, 2000 11:05 AM
<BR>
| &gt; | &gt; | &gt; Subject: Re: Re: Как следует компилировать рефальскую операцию отождествления
<BR>
| &gt; | &gt; | &gt;
<BR>
| &gt; | &gt; | &gt;
<BR>
| &gt; | &gt; | &gt; | Arkady Klimov wrote:
<BR>
| &gt; | &gt; | &gt; |
<BR>
| &gt; | &gt; | &gt; | &gt; Сергей Михайлович, привет,
<BR>
| &gt; | &gt; | &gt; | &gt; привет участникам дискуссии!
<BR>
| &gt; | &gt; | &gt; | &gt; Спасибо за инициативу и интересные материалы.
<BR>
| &gt; | &gt; | &gt; | &gt; Прошу прощения, что долго не включался, отвечать было недосуг, но я все
<BR>
| &gt; | &gt; | &gt; | &gt; читал и более-менее разбирался. Все очень интересно. Для Р+ и вообще
<BR>
| &gt; | &gt; | &gt; | &gt; отображение в массивное представление это то, что надо. Но в первом письме
<BR>
| &gt; | &gt; | &gt; | &gt; ты писал, что эти методы будут также интересны для реализаторов Р-5 и т.п.,
<BR>
| &gt; | &gt; | &gt; | &gt; то есть рефалов на списковом представлении. У меня есть в этом сомнения,
<BR>
| &gt; | &gt; | &gt; | &gt; попробуй их развеять. Ты справедливо замечаешь, что сложность операций может быть
<BR>
| &gt; | &gt; | &gt; | &gt; (и будет для списков) O(L). Но дальше ты писал, что алгоритм от этого не зависит.
<BR>
| &gt; | &gt; | &gt; | &gt; Согласен, алгоритм не зависит, но сложность его зависит и возможно радикально.
<BR>
| &gt; | &gt; | &gt; | &gt; Рассмотрим пример такого образца (из функции доступа к копилке):
<BR>
| &gt; | &gt; | &gt; | &gt;
<BR>
| &gt; | &gt; | &gt; | &gt; (e.name) (e.1 (e.name '=' e.value) e2)
<BR>
| &gt; | &gt; | &gt; | &gt;
<BR>
| &gt; | &gt; | &gt; | &gt; При существующей реализации его сложность - это объем символов из содержимого
<BR>
| &gt; | &gt; | &gt; | &gt; правого списка, которые надо просмотреть при поиске. Когда сравнение неудачное,
<BR>
| &gt; | &gt; | &gt; | &gt; это обычно 1-2 символа на одно имя. То есть время будет грубо пропорционально
<BR>
| &gt; | &gt; | &gt; | &gt; количеству имен. Если же перед сравнением мы будет сначала вычислять длину,
<BR>
| &gt; | &gt; | &gt; | &gt; тратя O(L), то время поиска резко увеличится в разы - пропорционально средней
<BR>
| &gt; | &gt; | &gt; | &gt; длине имени.
<BR>
| &gt; | &gt; | &gt; |
<BR>
| &gt; | &gt; | &gt; | С моей точки зрения правильная списковая реализация для рефал-выражений
<BR>
| &gt; | &gt; | &gt; | должна отслеживать их длину при конкатенациях и отщеплениях - это
<BR>
| &gt; | &gt; | &gt; | не вносит никакого оверхеда. Также могут существуют другие полезные
<BR>
| &gt; | &gt; | &gt; | инварианты, следить за которыми не мешало бы. Так, в новом рантайме
<BR>
| &gt; | &gt; | &gt; | рефала+ реализован флаг, указывающий, что выражение является &quot;flat&quot;,
<BR>
| &gt; | &gt; | &gt; | т.е. не содержит скобочных термов.
<BR>
| &gt; | &gt; | &gt;
<BR>
| &gt; | &gt; | &gt; Что значит &quot;отслеживать&quot;, &quot;следить&quot;? Хранить (длину содержимого)
<BR>
| &gt; | &gt; | &gt; внутри всех термов? В принципе, это, наверно, возможно. Правда,
<BR>
| &gt; | &gt; | &gt; по всей видимости, тогда придется смириться с таким минусом, как то,
<BR>
| &gt; | &gt; | &gt; что в следующей функции
<BR>
| &gt; | &gt; | &gt;
<BR>
| &gt; | &gt; | &gt; Dela
<BR>
| &gt; | &gt; | &gt;
<BR>
| &gt; | &gt; | &gt;     'a' e.1 = &lt;Dela e.1&gt;;
<BR>
| &gt; | &gt; | &gt;     s.a e.1 = s.a &lt;Dela e1&gt;;
<BR>
| &gt; | &gt; | &gt;     =;
<BR>
| &gt; | &gt; | &gt;     }
<BR>
| &gt; | &gt; | &gt;
<BR>
| &gt; | &gt; | &gt; рекурсия уже не будет концевой. Не дорога ли цена?
<BR>
| &gt; | &gt; |
<BR>
| &gt; | &gt; | В первом случае будет нормальный хвостовой вызов и ничто этому
<BR>
| &gt; | &gt; | не помешает, а во втором случае его не будет - куда конкатенацию девать?
<BR>
| &gt; | &gt; | Хвостовой вызов там может быть, только если у нас семантика ленивая -
<BR>
| &gt; | &gt; | сначала делаем конкатенацию с неготовым выражением, а потом вычисляем выражение.
<BR>
| &gt; | &gt; |
<BR>
| &gt; | &gt; Да, точнее, если реализация конкатенации у нас ленивая
<BR>
| &gt; | &gt; (на семантику-то языка это не влияет),
<BR>
| &gt; | &gt; а еще точнее - нестрогая (то есть выполняется раньше своих аргументов).
<BR>
| &gt; | &gt; Именно такая сейчас в рефалах 5 и 6. Поэтому не будет большой проблемой
<BR>
| &gt; | &gt; запустить указанную функцию над последовательностью из 1000000 символов.
<BR>
| &gt; |
<BR>
| &gt; | Ммм... Конкатенация-то может быть нестрогой, а вот как наччет хвостового
<BR>
| &gt; | вызова дальше? Хвостовой вызов предполагает, что мы полностью освобождаемся
<BR>
| &gt; | от контекста _вызывающей_ функции. Однако нам в итоге нужно в качестве
<BR>
| &gt; | результата вернуть результат конкатенации и _вызываемая_ функция ничего
<BR>
| &gt; | про него знать не должна, поскольку он не находится в рамках ее контекста.
<BR>
| &gt; | Если в рефалах 5 и 6 такое реализовано, то интересно, как при этом
<BR>
| &gt; | удалось обойтись без всяких нечестных хаков?
<BR>
| &gt;
<BR>
| &gt; Никаких &quot;нечестных хаков&quot;. Это прямое следствие реализаци рефала на двусторонних списках.
<BR>
| &gt; Такая техника применялась в реализациях рефала с начала 70-х годов, если не раньше
<BR>
| &gt; (до Рефала Плюс). Каждый элемент имеет ссылку на предыдущий и на следующий элементы.
<BR>
| &gt; Каждая функция просто  вставляет свой результат туда, где перед этим находился ее вызов,
<BR>
| &gt; на его место. При этом вызов - это один (так в шестом, в некоторых реализациях - больше)
<BR>
| &gt; элемент двустороннего списка, результат может состоять из нескольких элементов
<BR>
| &gt; или вообще не содержать ни одного (пусто). В последнем случае элементы,
<BR>
| &gt; окружающие вызов просто сшиваются друг с другом. Исходный вызов после вставки результата
<BR>
| &gt; (возможно, содержащего еще не вычисленные вызовы других функций) бросается в корзину.
<BR>
|
<BR>
| Ага, старая добрая конкретизация, которую я хорошо помню еше по рефалу-2.
<BR>
| Все это замечательно с одной маленькой оговоркой: это честно работает
<BR>
| только в интерпретирующих системах. В случае же компиляции в языки
<BR>
| более низкого уровня или в машинный код такой фокус не пройдет.
<BR>
<P>Да, Андрей, тут Вы правы. Только, пожалуй, с одним &quot;но&quot;: если речь идет о компиляции
<BR>
в машинный код для списковой реализации, то скорее всего имеется в виду компиляция
<BR>
в формате встроенных функций для интерпретирующей реализации - а это означает, что
<BR>
и скомпилированные функции и нескомпилированные должны уметь работать совместно,
<BR>
передавая друг другу данные - и данные одинаково устроенные. И тут мы возвращаемся
<BR>
к тому с чего начали - практической невозможности организовать вычисление и хранение
<BR>
длин списков с приемлемой для режима интерпретации сложностью. Короче, я бы
<BR>
призывал не мудрствовать по поводу &quot;единой для всех&quot; схемы компиляции, а просто вести
<BR>
ее разработку с прицелом на векторное представление, не оглядываясь на списки.
<BR>
<P>Аркадий.
<BR>
<P>| Андрей(С)
<BR>
|
<BR>
| --
<BR>
| A right thing should be simple (tm)
<BR>
<P><!-- body="end" -->
<HR>
<P>
<UL>
<!-- next="start" -->
<LI><STRONG>Next message:</STRONG> <A HREF="0161.html">Sergei M. Abramov (at home): "Re: Как следует компилировать рефальскую операцию отождествления"</A>
<LI><STRONG>Previous message:</STRONG> <A HREF="0159.html">Andrey Slepuhin: "Re: Re: Re: Re: Re:  Как следует компилироват ь ре фаль скую  операциюотождествления"</A>
<LI><STRONG>In reply to:</STRONG> <A HREF="0159.html">Andrey Slepuhin: "Re: Re: Re: Re: Re:  Как следует компилироват ь ре фаль скую  операциюотождествления"</A>
<!-- nextthread="start" -->
<LI><STRONG>Next in thread:</STRONG> <A HREF="0161.html">Sergei M. Abramov (at home): "Re: Как следует компилировать рефальскую операцию отождествления"</A>
<LI><STRONG>Reply:</STRONG> <A HREF="0159.html">Arkady Klimov: "Re: Re: Re: Re: Re: Как следует компилиоват ь ре фаль скую  операциюотождествлени"</A>
<!-- reply="end" -->
</UL>
<!-- trailer="footer" -->
<HR>
<P>
<SMALL>
<EM>
This archive was generated by <A HREF="http://www.fts.frontec.se/~dast/hypermail/">hypermail 2b25</A> 
: <EM>Mon Oct 25 2004 - 21:24:58 MSD</EM>
</EM>
</SMALL>
</BODY>
</HTML>
