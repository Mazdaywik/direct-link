<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD>
<TITLE>refal-plus@botik.ru -- Discussing the Refal+ programming langua</TITLE>
<META NAME="Author" CONTENT="Arkady Klimov (klimovark@mail.ru)">
<META NAME="Subject" CONTENT="Re: Urgent!!! Help needed! Refal+ &amp; virtual code">
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000">
<H1 ALIGN=CENTER>Re: Urgent!!! Help needed! Refal+ &amp; virtual code</H1>
<HR>
<P>
<!-- received="Mon Dec  6 15:27:34 1999 MSK" -->
<!-- sent="Mon, 6 Dec 1999 14:29:09 +0300" -->
<!-- name="Arkady Klimov" -->
<!-- email="klimovark@mail.ru" -->
<!-- subject="Re: Urgent!!! Help needed! Refal+ &amp; virtual code" -->
<!-- id="00aa01bf3fdd$1e7994f0$97925bc3@bagirra.rinet.ru" -->
<!-- inreplyto="384B91FC.F50E515A@msu.ru" -->
<STRONG>Arkady Klimov</STRONG> (<A HREF="mailto:klimovark@mail.ru?subject=Re:%20Urgent!!!%20Help%20needed!%20Refal%2B%20&amp;%20virtual%20code"><EM>klimovark@mail.ru</EM></A>)<BR>
<EM>Mon, 6 Dec 1999 14:29:09 +0300</EM>
<P>
<UL>
<LI><STRONG>Messages sorted by:</STRONG> 
<A HREF="date.html#88">[ date ]</A>
<A HREF="index.html#88">[ thread ]</A>
<A HREF="subject.html#88">[ subject ]</A>
<A HREF="author.html#88">[ author ]</A>
<!-- next="start" -->
<LI><STRONG>Next message:</STRONG> <A HREF="0089.html">Andrey Slepuhin: "Re: Urgent!!! Help needed! Refal+ &amp; virtual code"</A>
<LI><STRONG>Previous message:</STRONG> <A HREF="0087.html">Andrey Slepuhin: "Urgent!!! Help needed! Refal+ &amp; virtual code"</A>
<!-- nextthread="start" -->
<LI><STRONG>Next in thread:</STRONG> <A HREF="0089.html">Andrey Slepuhin: "Re: Urgent!!! Help needed! Refal+ &amp; virtual code"</A>
<!-- reply="end" -->
</UL>
<HR>
<!-- body="start" -->
<P>
----- Original Message -----
<BR>
From: Andrey Slepuhin &lt;<A HREF="mailto:pooh@msu.ru?subject=Re:%20Urgent!!!%20Help%20needed!%20Refal%2B%20&amp;%20virtual%20code">pooh@msu.ru</A>&gt;
<BR>
To: Refal Plus mailing list &lt;<A HREF="mailto:refal-plus@botik.ru?subject=Re:%20Urgent!!!%20Help%20needed!%20Refal%2B%20&amp;%20virtual%20code">refal-plus@botik.ru</A>&gt;
<BR>
Sent: Monday, December 06, 1999 1:37 PM
<BR>
Subject: Urgent!!! Help needed! Refal+ &amp; virtual code
<BR>
<P><P><EM>&gt; День добрый всем!
</EM><BR>
<EM>&gt;
</EM><BR>
<EM>&gt; Я практически закончил генерацию виртуального кода в текущем
</EM><BR>
Рефале+.
<BR>
<EM>&gt; Есть одна _большая_ проблема: хочется выдавать виртуальный код
</EM><BR>
<EM>&gt; в виде объектного выражения, которое может быть потом опять считано.
</EM><BR>
<EM>&gt; Однако в выводе есть символы-ссылки, например команда виртуального
</EM><BR>
кода
<BR>
<EM>&gt;
</EM><BR>
<EM>&gt;   PUSHQ &amp;Some-Box
</EM><BR>
<EM>&gt;
</EM><BR>
<EM>&gt; запихивает на стек объектное выражение, состоящее из символа-ссылки
</EM><BR>
<EM>&gt; Some-Box. Объектное выражение, содержащее символы-ссылки, в текущей
</EM><BR>
<EM>&gt; реализации считано быть не может. Более того, я пока не очень хорошо
</EM><BR>
<EM>&gt; представляю, во что это может быть преобразовано при вводе.
</EM><BR>
<EM>&gt; Если есть какие-нибудь идеи на этот счет - просьба высказываться,
</EM><BR>
<EM>&gt; я очень не хочу тянуть с выкладыванием новой версии.
</EM><BR>
<EM>&gt;
</EM><BR>
<EM>&gt; Всего доброго,
</EM><BR>
<EM>&gt; Андрей.
</EM><BR>
<EM>&gt;
</EM><BR>
Думаю, я могу предложить вариант решения - по прямой аналогии с тем,
<BR>
как это сделано в Рефале-6. Там ведь тоже есть эта проблема - в
<BR>
виртуальном коде (языке сборки) рефала-6 тоже константы записываются
<BR>
сами собой, виртуальный код является выражением, которое выводится в
<BR>
файл (текстовый) средствами вывода объектных выражений.
<BR>
<P>Символы ссылки выводятся так, как они записываются на рефале, в данном
<BR>
случае -
<BR>
<P>PUSHQ &amp;Some-Box
<BR>
<P>Речь идет о выводе функцией WRITE. Чтобы это было возможно функция
<BR>
вывода должна иметь доступ к информации об имени, ассоциированном с
<BR>
символом ссылкой. В рефале-6 эта ассоциация устанавливается при помощи
<BR>
таблицы, где в качестве основного ключа выступает слово (имя), а
<BR>
значение - символ-ссылка. Особенностью таблиц в Рефале-6 является то,
<BR>
что они работают в обе стороны: позволяют как узнавать по имени
<BR>
значение, так и по значению находить имя (первое попавшееся). При
<BR>
выводе таблица используется для определения имени по значению.
<BR>
<P>Теперь рассмотрим ввод.
<BR>
В идеале,нужно для ввода иметь под рукой ту же таблицу, которая была
<BR>
использована при выводе - тогде нет проблем.
<BR>
Но даже если этой таблицы нет, все равно остается возможность
<BR>
осуществить ввод так, чтобы одинаково поименованные внешние
<BR>
символы-ссылки превратились в одинаковые
<BR>
внутренние символы-ссылки и наоборот. Для этого будем осуществлять
<BR>
ввод по следующему алгоритму.
<BR>
Вначале для ввода создается свежая пустая таблица (или в нее
<BR>
помещаются ассоциации, соответствующие окружению данного модуля).
<BR>
Затем, когда вводится модуль и вводится очередной символ-ссылка, в
<BR>
таблице ищется вхождение с этим именем. Если есть, все в порядке,
<BR>
берем соответствующее значение. Если же нет, то создаем новую ссылку
<BR>
(через &lt;NEW&gt;), помещаем информацию о ней в таблицу под своим именем, и
<BR>
помещаем ее в результат.
<BR>
В конце ввода в наших руках остается таблица, содержащая сведения о
<BR>
всех введенных символах-ссылках.
<BR>
<P>Возможная проблема будет в том, что при вводе ссылки неизвестен ее
<BR>
тип: BOX, STRING, FUNC или что еще. В рефале-6 она решается тем, что
<BR>
есть универсальный тип символа-ссылки, символа, который, уже после его
<BR>
создания (функцией &lt;NEW&gt;), может быть преобразован (без изменения
<BR>
значения самой ссылки) в ссылку любого типа. Что-то подобное, наверно,
<BR>
надо обеспечить и для Рефала Плюс, если это возможно.
<BR>
<P>Всего наилучшего.
<BR>
Аркадий.
<BR>
<P><!-- body="end" -->
<HR>
<P>
<UL>
<!-- next="start" -->
<LI><STRONG>Next message:</STRONG> <A HREF="0089.html">Andrey Slepuhin: "Re: Urgent!!! Help needed! Refal+ &amp; virtual code"</A>
<LI><STRONG>Previous message:</STRONG> <A HREF="0087.html">Andrey Slepuhin: "Urgent!!! Help needed! Refal+ &amp; virtual code"</A>
<!-- nextthread="start" -->
<LI><STRONG>Next in thread:</STRONG> <A HREF="0089.html">Andrey Slepuhin: "Re: Urgent!!! Help needed! Refal+ &amp; virtual code"</A>
<!-- reply="end" -->
</UL>
<!-- trailer="footer" -->
<HR>
<P>
<SMALL>
<EM>
This archive was generated by <A HREF="http://www.landfield.com/hypermail/">hypermail 2.0b3</A> 
on <EM>Mon Dec 06 1999 - 15:27:42 MSK</EM>
</EM>
</SMALL>
</BODY>
</HTML>
