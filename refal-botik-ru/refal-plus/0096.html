<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD>
<TITLE>refal-plus@botik.ru -- Discussing the Refal+ programming langua</TITLE>
<META NAME="Author" CONTENT="Andrey Slepuhin (pooh@msu.ru)">
<META NAME="Subject" CONTENT="Re: About new Refal+ release">
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000">
<H1 ALIGN=CENTER>Re: About new Refal+ release</H1>
<HR>
<P>
<!-- received="Thu Dec  9 16:22:10 1999 MSK" -->
<!-- sent="Thu, 09 Dec 1999 16:21:20 +0300" -->
<!-- name="Andrey Slepuhin" -->
<!-- email="pooh@msu.ru" -->
<!-- subject="Re: About new Refal+ release" -->
<!-- id="384FACD0.EC589B47@msu.ru" -->
<!-- inreplyto="384E8535.2C730D6A@msu.ru" -->
<STRONG>Andrey Slepuhin</STRONG> (<A HREF="mailto:pooh@msu.ru?subject=Re:%20About%20new%20Refal%2B%20release"><EM>pooh@msu.ru</EM></A>)<BR>
<EM>Thu, 09 Dec 1999 16:21:20 +0300</EM>
<P>
<UL>
<LI><STRONG>Messages sorted by:</STRONG> 
<A HREF="date.html#96">[ date ]</A>
<A HREF="index.html#96">[ thread ]</A>
<A HREF="subject.html#96">[ subject ]</A>
<A HREF="author.html#96">[ author ]</A>
<!-- next="start" -->
<LI><STRONG>Next message:</STRONG> <A HREF="0097.html">Arkady Klimov: "Re: About new Refal+ release"</A>
<LI><STRONG>Previous message:</STRONG> <A HREF="0095.html">Arkady Klimov: "Re: About new Refal+ release"</A>
<LI><STRONG>In reply to:</STRONG> <A HREF="0092.html">Andrey Slepuhin: "About new Refal+ release"</A>
<!-- nextthread="start" -->
<LI><STRONG>Next in thread:</STRONG> <A HREF="0097.html">Arkady Klimov: "Re: About new Refal+ release"</A>
<!-- reply="end" -->
</UL>
<HR>
<!-- body="start" -->
<P>
Arkady Klimov wrote:
<BR>
<P>[snip]
<BR>
<P><EM>&gt; &gt; &gt; &gt;    а) Новые команды LEIS/LVIS/LES,REIS/RVIS/RES - семантика
</EM><BR>
<EM>&gt; &gt; &gt; &gt;       следующая (на примере LEIS/LVIS/LES):
</EM><BR>
<EM>&gt; &gt; &gt; &gt;       &lt; LEIS m : LES : C, S, D, E &gt;  =&gt;
</EM><BR>
<EM>&gt; &gt; &gt; &gt;         { S/m = Oe и Oe : S =S' } &lt; C, S', (LES : C, S') : D, E&gt;
</EM><BR>
<EM>&gt; &gt; &gt; &gt;       &lt; LVIS m : LES : C, S, D, E &gt;  =&gt;
</EM><BR>
<EM>&gt; &gt; &gt; &gt;         { S/m = Oe } &lt; LES : C, Oe : S, D, E&gt;
</EM><BR>
<EM>&gt; &gt; &gt; &gt;       &lt; LES : C, OtOe' : S, D, E &gt;  =&gt; { Oe' : S = S' } &lt; C, S', (LES
</EM><BR>
<EM>&gt; :
</EM><BR>
<EM>&gt; &gt; &gt; &gt; C : S') D, E&gt;
</EM><BR>
<EM>&gt; &gt; &gt; &gt;       &lt; LES : C, p : S, D, E &gt;  =&gt; &lt; FAIL : [], S, D, E&gt;
</EM><BR>
<EM>&gt; &gt; &gt; - это оптимизированные команды удлинения. Используются в случае, когда
</EM><BR>
<EM>&gt; &gt; &gt; просмотренная часть (e1 в образце e1 sA e2) далее в теле функции не
</EM><BR>
<EM>&gt; &gt; &gt; используется.
</EM><BR>
<EM>&gt; &gt; &gt; (Если конечно, я это правильно понял. Андрей, поправь меня, если это не
</EM><BR>
<EM>&gt; &gt; &gt; так).
</EM><BR>
<EM>&gt; &gt;
</EM><BR>
<EM>&gt; &gt; Абсолютно точно. На самом деле я бы кое-что поменял в командах
</EM><BR>
<EM>&gt; &gt; отщепления - уж больно они запутанные, и мне совсем не нравится
</EM><BR>
<EM>&gt; &gt; требование, чтобы LEI/LE всегда были рядом. На самом деле все
</EM><BR>
<EM>&gt; &gt; можно сделать более прозрачно с явными ALT'ами, и обойтись вообще
</EM><BR>
<EM>&gt; &gt; без команд типа LEI. Если что - я могу подробно описать то, как я
</EM><BR>
<EM>&gt; &gt; все это вижу.
</EM><BR>
<EM>&gt; Да, это интересно. Если получается, это будет, наверно, лучше. Напиши,
</EM><BR>
<EM>&gt; пожалуйста.
</EM><BR>
<P>LE предлагается изменить следующим образом (я обзову эту команду LX,
<BR>
чтобы
<BR>
не было путаницы):
<BR>
&nbsp;&nbsp;&lt; LX : C, OtOe&quot; : Oe' : S, D, E &gt;  =&gt;  &lt; C, Oe&quot; : Oe'Ot : S, D, E &gt;
<BR>
&nbsp;&nbsp;&lt; LX : C, p : Oe : S, D, E &gt;  =&gt;  &lt; FAIL : [], S, D, E &gt;
<BR>
<P>Тогда пара команд LEI m : LE заменяется на
<BR>
&nbsp;&nbsp;PUSHEMP
<BR>
&nbsp;&nbsp;PUSH m+1
<BR>
&nbsp;&nbsp;JUMP L2
<BR>
&nbsp;&nbsp;LABEL L1
<BR>
&nbsp;&nbsp;LX
<BR>
&nbsp;&nbsp;LABEL L2
<BR>
&nbsp;&nbsp;ALT L1
<BR>
&nbsp;&nbsp;...
<BR>
<P>A LVI m : LE заменяется на
<BR>
&nbsp;&nbsp;PUSHEMP
<BR>
&nbsp;&nbsp;PUSH m+1
<BR>
&nbsp;&nbsp;LABEL L1
<BR>
&nbsp;&nbsp;LX
<BR>
&nbsp;&nbsp;ALT L1
<BR>
&nbsp;&nbsp;...
<BR>
<P>Аналогично поступаем с LEIS/LES и с отщеплениями справа.
<BR>
Кстати сказать, в реальной жизни так отщепления в ассемблер и
<BR>
компилируются.
<BR>
<P>[snip]
<BR>
<P><EM>&gt; &gt; &gt; &gt;    в) Директивы:
</EM><BR>
<EM>&gt; &gt; &gt; &gt;       IMPORT/EXPORT/LOCAL FUNC/BOX/TABLE/VECTOR/STRING/CHANNEL -
</EM><BR>
<EM>&gt; &gt; &gt; &gt;       семантика очевидна.
</EM><BR>
<EM>&gt; &gt; &gt; А какой синтаксис? (Речь идет ведь не о рефале, а о виртуальном коде,
</EM><BR>
<EM>&gt; да?)
</EM><BR>
<EM>&gt; &gt; &gt; Какая семантика LOCAL FUNC (в отличие от FUNC)? Это два слова?
</EM><BR>
<EM>&gt; &gt;
</EM><BR>
<EM>&gt; &gt; Просто FUNC нету. Т.е. синтаксис директивы _всегда_ содержит два
</EM><BR>
<EM>&gt; &gt; слова - linkage class (не знаю, как это сказать по русски) и тип
</EM><BR>
<EM>&gt; &gt; объекта.
</EM><BR>
<EM>&gt; &gt; Это как раз спорное место, которое я хотел обсудить. Не стоит ли разбить
</EM><BR>
<EM>&gt; &gt; каждую директиву на две?
</EM><BR>
<EM>&gt; Ох, я совсем ничего не понял, можно поподробнее?
</EM><BR>
<P>Я сделал так - возьмем для примера функцию, для нее возможны
<BR>
три директивы:
<BR>
&nbsp;&nbsp;&nbsp;IMPORT FUNC &lt;fname&gt; - функция определена где-то в другом модуле
<BR>
&nbsp;&nbsp;&nbsp;EXPORT FUNC &lt;fname&gt; - функция определена в нашем модуле и является
<BR>
глобальной
<BR>
&nbsp;&nbsp;&nbsp;LOCAL FUNC &lt;fname&gt;  - функция определена в нашем модуле и является
<BR>
локальной
<BR>
<P>То же самое для других объектов, для них, кроме того, объявления EXPORT
<BR>
и
<BR>
LOCAL являются сразу и определениями.
<BR>
Другой возможный вариант - разнести это по разным директивам. Тогда
<BR>
мы будем писать, скажем
<BR>
&nbsp;&nbsp;BOX &lt;name&gt;
<BR>
&nbsp;&nbsp;EXPORT &lt;name&gt;
<BR>
<P>Почему я объединил определение объекта и его linkage вместе?
<BR>
Потому что тогда очень легко по одной директиве сразу построить
<BR>
необходимое объявление при компиляции, скажем в С, да и виртуальный код
<BR>
меньше загромождается. Например:
<BR>
&nbsp;&nbsp;IMPORT BOX Box    =&gt;
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;extern rf_box_t Box;
<BR>
&nbsp;&nbsp;EXPORT BOX Box    =&gt;
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rf_box_t Box;
<BR>
&nbsp;&nbsp;LOCAL BOX Box    =&gt;
<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;static rf_box_t Box;
<BR>
<P>Однако, здесь могут быть другие мнения, и я с радостью их
<BR>
выслушаю.
<BR>
<P>Всего доброго,
<BR>
Андрей.
<BR>
<P><!-- body="end" -->
<HR>
<P>
<UL>
<!-- next="start" -->
<LI><STRONG>Next message:</STRONG> <A HREF="0097.html">Arkady Klimov: "Re: About new Refal+ release"</A>
<LI><STRONG>Previous message:</STRONG> <A HREF="0095.html">Arkady Klimov: "Re: About new Refal+ release"</A>
<LI><STRONG>In reply to:</STRONG> <A HREF="0092.html">Andrey Slepuhin: "About new Refal+ release"</A>
<!-- nextthread="start" -->
<LI><STRONG>Next in thread:</STRONG> <A HREF="0097.html">Arkady Klimov: "Re: About new Refal+ release"</A>
<!-- reply="end" -->
</UL>
<!-- trailer="footer" -->
<HR>
<P>
<SMALL>
<EM>
This archive was generated by <A HREF="http://www.landfield.com/hypermail/">hypermail 2.0b3</A> 
on <EM>Thu Dec 09 1999 - 16:22:12 MSK</EM>
</EM>
</SMALL>
</BODY>
</HTML>
