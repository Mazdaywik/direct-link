<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD>
<TITLE>refal-plus@botik.ru -- Discussing the Refal+ programming langua</TITLE>
<META NAME="Author" CONTENT="Andrey Slepuhin (pooh@msu.ru)">
<META NAME="Subject" CONTENT="Re: Urgent!!! Help needed! Refal+ &amp; virtual code">
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000">
<H1 ALIGN=CENTER>Re: Urgent!!! Help needed! Refal+ &amp; virtual code</H1>
<HR>
<P>
<!-- received="Tue Dec  7 13:43:37 1999 MSK" -->
<!-- sent="Tue, 07 Dec 1999 13:41:34 +0300" -->
<!-- name="Andrey Slepuhin" -->
<!-- email="pooh@msu.ru" -->
<!-- subject="Re: Urgent!!! Help needed! Refal+ &amp; virtual code" -->
<!-- id="384CE45E.BF191FE3@msu.ru" -->
<!-- inreplyto="384B91FC.F50E515A@msu.ru" -->
<STRONG>Andrey Slepuhin</STRONG> (<A HREF="mailto:pooh@msu.ru?subject=Re:%20Urgent!!!%20Help%20needed!%20Refal%2B%20&amp;%20virtual%20code"><EM>pooh@msu.ru</EM></A>)<BR>
<EM>Tue, 07 Dec 1999 13:41:34 +0300</EM>
<P>
<UL>
<LI><STRONG>Messages sorted by:</STRONG> 
<A HREF="date.html#89">[ date ]</A>
<A HREF="index.html#89">[ thread ]</A>
<A HREF="subject.html#89">[ subject ]</A>
<A HREF="author.html#89">[ author ]</A>
<!-- next="start" -->
<LI><STRONG>Next message:</STRONG> <A HREF="0090.html">Arkady Klimov: "Re: Urgent!!! Help needed! Refal+ &amp; virtual code"</A>
<LI><STRONG>Previous message:</STRONG> <A HREF="0088.html">Arkady Klimov: "Re: Urgent!!! Help needed! Refal+ &amp; virtual code"</A>
<LI><STRONG>In reply to:</STRONG> <A HREF="0087.html">Andrey Slepuhin: "Urgent!!! Help needed! Refal+ &amp; virtual code"</A>
<!-- nextthread="start" -->
<LI><STRONG>Next in thread:</STRONG> <A HREF="0090.html">Arkady Klimov: "Re: Urgent!!! Help needed! Refal+ &amp; virtual code"</A>
<!-- reply="end" -->
</UL>
<HR>
<!-- body="start" -->
<P>
Arkady Klimov wrote:
<BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; ----- Original Message -----
</EM><BR>
<EM>&gt; From: Andrey Slepuhin &lt;<A HREF="mailto:pooh@msu.ru?subject=Re:%20Urgent!!!%20Help%20needed!%20Refal%2B%20&amp;%20virtual%20code">pooh@msu.ru</A>&gt;
</EM><BR>
<EM>&gt; To: Refal Plus mailing list &lt;<A HREF="mailto:refal-plus@botik.ru?subject=Re:%20Urgent!!!%20Help%20needed!%20Refal%2B%20&amp;%20virtual%20code">refal-plus@botik.ru</A>&gt;
</EM><BR>
<EM>&gt; Sent: Monday, December 06, 1999 1:37 PM
</EM><BR>
<EM>&gt; Subject: Urgent!!! Help needed! Refal+ &amp; virtual code
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; &gt; День добрый всем!
</EM><BR>
<EM>&gt; &gt;
</EM><BR>
<EM>&gt; &gt; Я практически закончил генерацию виртуального кода в текущем
</EM><BR>
<EM>&gt; Рефале+.
</EM><BR>
<EM>&gt; &gt; Есть одна _большая_ проблема: хочется выдавать виртуальный код
</EM><BR>
<EM>&gt; &gt; в виде объектного выражения, которое может быть потом опять считано.
</EM><BR>
<EM>&gt; &gt; Однако в выводе есть символы-ссылки, например команда виртуального
</EM><BR>
<EM>&gt; кода
</EM><BR>
<EM>&gt; &gt;
</EM><BR>
<EM>&gt; &gt;   PUSHQ &amp;Some-Box
</EM><BR>
<EM>&gt; &gt;
</EM><BR>
<EM>&gt; &gt; запихивает на стек объектное выражение, состоящее из символа-ссылки
</EM><BR>
<EM>&gt; &gt; Some-Box. Объектное выражение, содержащее символы-ссылки, в текущей
</EM><BR>
<EM>&gt; &gt; реализации считано быть не может. Более того, я пока не очень хорошо
</EM><BR>
<EM>&gt; &gt; представляю, во что это может быть преобразовано при вводе.
</EM><BR>
<EM>&gt; &gt; Если есть какие-нибудь идеи на этот счет - просьба высказываться,
</EM><BR>
<EM>&gt; &gt; я очень не хочу тянуть с выкладыванием новой версии.
</EM><BR>
<EM>&gt; &gt;
</EM><BR>
<EM>&gt; &gt; Всего доброго,
</EM><BR>
<EM>&gt; &gt; Андрей.
</EM><BR>
<EM>&gt; &gt;
</EM><BR>
<EM>&gt; Думаю, я могу предложить вариант решения - по прямой аналогии с тем,
</EM><BR>
<EM>&gt; как это сделано в Рефале-6. Там ведь тоже есть эта проблема - в
</EM><BR>
<EM>&gt; виртуальном коде (языке сборки) рефала-6 тоже константы записываются
</EM><BR>
<EM>&gt; сами собой, виртуальный код является выражением, которое выводится в
</EM><BR>
<EM>&gt; файл (текстовый) средствами вывода объектных выражений.
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; Символы ссылки выводятся так, как они записываются на рефале, в данном
</EM><BR>
<EM>&gt; случае -
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; PUSHQ &amp;Some-Box
</EM><BR>
<EM>&gt; 
</EM><BR>
<EM>&gt; Речь идет о выводе функцией WRITE. Чтобы это было возможно функция
</EM><BR>
<EM>&gt; вывода должна иметь доступ к информации об имени, ассоциированном с
</EM><BR>
<EM>&gt; символом ссылкой. В рефале-6 эта ассоциация устанавливается при помощи
</EM><BR>
<EM>&gt; таблицы, где в качестве основного ключа выступает слово (имя), а
</EM><BR>
<EM>&gt; значение - символ-ссылка. Особенностью таблиц в Рефале-6 является то,
</EM><BR>
<EM>&gt; что они работают в обе стороны: позволяют как узнавать по имени
</EM><BR>
<EM>&gt; значение, так и по значению находить имя (первое попавшееся). При
</EM><BR>
<EM>&gt; выводе таблица используется для определения имени по значению.
</EM><BR>
<P>В Рефале+ таких таблиц нет и в этом вся проблема.
<BR>
<P><EM>&gt; Теперь рассмотрим ввод.
</EM><BR>
<EM>&gt; В идеале,нужно для ввода иметь под рукой ту же таблицу, которая была
</EM><BR>
<EM>&gt; использована при выводе - тогде нет проблем.
</EM><BR>
<EM>&gt; Но даже если этой таблицы нет, все равно остается возможность
</EM><BR>
<EM>&gt; осуществить ввод так, чтобы одинаково поименованные внешние
</EM><BR>
<EM>&gt; символы-ссылки превратились в одинаковые
</EM><BR>
<EM>&gt; внутренние символы-ссылки и наоборот. Для этого будем осуществлять
</EM><BR>
<EM>&gt; ввод по следующему алгоритму.
</EM><BR>
<EM>&gt; Вначале для ввода создается свежая пустая таблица (или в нее
</EM><BR>
<EM>&gt; помещаются ассоциации, соответствующие окружению данного модуля).
</EM><BR>
<EM>&gt; Затем, когда вводится модуль и вводится очередной символ-ссылка, в
</EM><BR>
<EM>&gt; таблице ищется вхождение с этим именем. Если есть, все в порядке,
</EM><BR>
<EM>&gt; берем соответствующее значение. Если же нет, то создаем новую ссылку
</EM><BR>
<EM>&gt; (через &lt;NEW&gt;), помещаем информацию о ней в таблицу под своим именем, и
</EM><BR>
<EM>&gt; помещаем ее в результат.
</EM><BR>
<EM>&gt; В конце ввода в наших руках остается таблица, содержащая сведения о
</EM><BR>
<EM>&gt; всех введенных символах-ссылках.
</EM><BR>
<P>Вот-вот-вот. Пришлось примерно то же самое реализовывать в Рефале+.
<BR>
Теперь вроде все работает, но время пришлось потратить. Я-то надеялся,
<BR>
что может быть удастся обойтись без этого - не повезло :-(
<BR>
<P><EM>&gt; Возможная проблема будет в том, что при вводе ссылки неизвестен ее
</EM><BR>
<EM>&gt; тип: BOX, STRING, FUNC или что еще. В рефале-6 она решается тем, что
</EM><BR>
<EM>&gt; есть универсальный тип символа-ссылки, символа, который, уже после его
</EM><BR>
<EM>&gt; создания (функцией &lt;NEW&gt;), может быть преобразован (без изменения
</EM><BR>
<EM>&gt; значения самой ссылки) в ссылку любого типа. Что-то подобное, наверно,
</EM><BR>
<EM>&gt; надо обеспечить и для Рефала Плюс, если это возможно.
</EM><BR>
<P>Здесь я пока не стал возиться с преобразованиями. Для работы с
<BR>
виртуальным
<BR>
кодом это реально не понадобится - нужно только ввести функцию, которая
<BR>
по ссылке достает ее имя.
<BR>
<P>Всего доброго,
<BR>
Андрей.
<BR>
<P><!-- body="end" -->
<HR>
<P>
<UL>
<!-- next="start" -->
<LI><STRONG>Next message:</STRONG> <A HREF="0090.html">Arkady Klimov: "Re: Urgent!!! Help needed! Refal+ &amp; virtual code"</A>
<LI><STRONG>Previous message:</STRONG> <A HREF="0088.html">Arkady Klimov: "Re: Urgent!!! Help needed! Refal+ &amp; virtual code"</A>
<LI><STRONG>In reply to:</STRONG> <A HREF="0087.html">Andrey Slepuhin: "Urgent!!! Help needed! Refal+ &amp; virtual code"</A>
<!-- nextthread="start" -->
<LI><STRONG>Next in thread:</STRONG> <A HREF="0090.html">Arkady Klimov: "Re: Urgent!!! Help needed! Refal+ &amp; virtual code"</A>
<!-- reply="end" -->
</UL>
<!-- trailer="footer" -->
<HR>
<P>
<SMALL>
<EM>
This archive was generated by <A HREF="http://www.landfield.com/hypermail/">hypermail 2.0b3</A> 
on <EM>Tue Dec 07 1999 - 13:43:38 MSK</EM>
</EM>
</SMALL>
</BODY>
</HTML>
